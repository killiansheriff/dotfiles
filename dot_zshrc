export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="robbyrussell"

plugins=(git)

source $ZSH/oh-my-zsh.sh

alias cexp="ssh ksheriff@login.expanse.sdsc.edu"
alias csup="ssh ksheriff@txe1-login.mit.edu"
alias ceng="ssh ksheriff@eofe8.mit.edu"
alias coknl="ssh ksheriff@home.ccs.ornl.gov"


. "$HOME/.local/bin/env"
export PATH="$HOME/.local/bin:$PATH"



# LaTeX compilation and cleanup function (biber runs by default)
texclean() {
    if [ -z "$1" ]; then
        echo "Usage: texclean <filename.tex> [options]"
        echo "Options:"
        echo "  --no-biber     Skip biber (bibliography processing)"
        echo "  -k, --keep     Keep auxiliary files (don't delete)"
        echo ""
        echo "By default, biber runs automatically for bibliography processing."
        echo ""
        echo "Examples:"
        echo "  texclean main.tex              # Compile with biber + cleanup"
        echo "  texclean main.tex --no-biber   # Skip biber"
        echo "  texclean main.tex --keep       # Keep aux files"
        return 1
    fi
    
    local texfile="$1"
    local basename="${texfile%.tex}"
    local run_biber=true
    local keep_aux=false
    
    # Parse options
    shift
    while [[ $# -gt 0 ]]; do
        case $1 in
            --no-biber)
                run_biber=false
                shift
                ;;
            -k|--keep)
                keep_aux=true
                shift
                ;;
            *)
                echo "Unknown option: $1"
                return 1
                ;;
        esac
    done
    
    echo "=== Compiling LaTeX document: $texfile ==="
    
    # First compilation
    pdflatex -interaction=nonstopmode "$texfile" > /dev/null 2>&1
    local exit_code=$?
    
    if [ $exit_code -ne 0 ] && [ $exit_code -ne 1 ]; then
        echo "❌ First compilation failed with exit code $exit_code"
        return $exit_code
    fi
    
    # Run biber by default
    if [ "$run_biber" = true ]; then
        echo "Running biber..."
        biber "$basename" 2>&1 | grep -E "(ERROR|WARN)" || echo "✓ Biber completed"
    fi
    
    # Second compilation for cross-references
    echo "Running second pass..."
    pdflatex -interaction=nonstopmode "$texfile" > /dev/null 2>&1
    
    # Third compilation to ensure everything is resolved
    echo "Running third pass..."
    pdflatex -interaction=nonstopmode "$texfile" > /dev/null 2>&1
    
    # Clean up auxiliary files unless --keep is specified
    if [ "$keep_aux" = false ]; then
        echo "Cleaning auxiliary files..."
        find . -name "*.aux" -type f -delete 2>/dev/null
        rm -f "${basename}.log" "${basename}.out" "${basename}.toc" \
              "${basename}.lof" "${basename}.lot" "${basename}.bcf" \
              "${basename}.run.xml" "${basename}.blg" "${basename}.bbl" \
              "${basename}.fls" "${basename}.fdb_latexmk" \
              "${basename}.synctex.gz" 2>/dev/null
    fi
    
    # Show final status
    echo ""
    echo "=== Compilation Complete ==="
    if [ -f "${basename}.pdf" ]; then
        local size=$(ls -lh "${basename}.pdf" | awk '{print $5}')
        echo "✓ PDF generated: ${basename}.pdf ($size)"
    else
        echo "❌ PDF not generated"
        return 1
    fi
    
    if [ "$keep_aux" = false ]; then
        echo "✓ Auxiliary files cleaned"
    else
        echo "✓ Auxiliary files kept"
    fi
}
